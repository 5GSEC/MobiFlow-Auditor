import subprocess
import xml.etree.ElementTree as ET

def encode_decode_structure(operation, structure_name, binary_payload):
    # Call the C program with the specified operation, structure name, and binary payload
    result = subprocess.run(["./wrapper", operation, structure_name, binary_payload], capture_output=True, text=True)

    # Return the result
    return result.stdout.strip()


def element_to_dict(element):
    # Initialize the dictionary to store the element's attributes and text
    result = {
        'tag': element.tag,
        'text': element.text.strip() if element.text else None,
        'attributes': element.attrib,
        'children': []
    }

    # Recursively convert the children elements to dictionaries
    for child in element:
        result['children'].append(element_to_dict(child))

    return result

# Example usage
if __name__ == "__main__":
    operation = "decode"
    structure_name = "E2SM_KPMv2_IndicationMessage"
    hex_payload = "000540818c000007001d000500007b0011000500020001000f000100001b00020000001c0001000019000f0e0165ef66b90002f899300000e000001a00815281500600004003e7001d003055452e524e5449003855452e494d534931003855452e494d534932002855452e524154004055452e4d5f544d5349006055452e4349504845525f414c47007855452e494e544547524954595f414c47005855452e454d4d5f4341555345007855452e52454c454153455f54494d4552008855452e45535441424c4953485f434155534500186d73673100186d73673200186d73673300186d73673400186d73673500186d73673600186d73673700186d73673800186d73673900206d7367313000206d7367313100206d7367313200206d7367313300206d7367313400206d7367313500206d7367313600206d7367313700206d7367313800206d7367313900206d736732300000001e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"

    structure_name = "E2SM_KPMv2_ActionDefinition"
    hex_payload = "000600000131001D003055452E524E5449003855452E494D534931003855452E494D534932002855452E524154004055452E4D5F544D5349006055452E4349504845525F414C47007855452E494E544547524954595F414C47005855452E454D4D5F4341555345007855452E52454C454153455F54494D4552008855452E45535441424C4953485F434155534500186D73673100186D73673200186D73673300186D73673400186D73673500186D73673600186D73673700186D73673800186D73673900206D7367313000206D7367313100206D7367313200206D7367313300206D7367313400206D7367313500206D7367313600206D7367313700206D7367313800206D7367313900206D736732304003E70000"

    structure_name = "E2SM_KPMv2_RANfunction_Description"
    hex_payload = "74184F52414E2D4532534D2D4B504D000018312E332E362E312E342E312E35333134382E312E322E322E3205004B504D206D6F6E69746F7200000000400002F899300000E0000000000001310002F8990000E00000000103805472696767657231000100061E804F2D43552D5550204D6561737572656D656E7420436F6E7461696E657220666F72207468652045504320636F6E6E6563746564206465706C6F796D656E740006001D40C055452E524E544900000040E055452E494D53493100000140E055452E494D53493200000240A055452E524154000003410055452E4D5F544D5349000004418055452E4349504845525F414C4700000541E055452E494E544547524954595F414C47000006416055452E454D4D5F434155534500000741E055452E52454C454153455F54494D4552000008422055452E45535441424C4953485F434155534500000940606D73673100000A40606D73673200000B40606D73673300000C40606D73673400000D40606D73673500000E40606D73673600000F40606D73673700001040606D73673800001140606D73673900001240806D7367313000001340806D7367313100001440806D7367313200001540806D7367313300001640806D7367313400001740806D7367313500001840806D7367313600001940806D7367313700001A40806D7367313800001B40806D7367313900001C40806D7367323000001D00010001"

    result = encode_decode_structure(operation, structure_name, hex_payload)
    print(result)

    d = element_to_dict(ET.fromstring(result))
    print(d)


